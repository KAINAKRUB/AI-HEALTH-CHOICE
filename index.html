<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI HEALTH CHOICE - Web Application Demo</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Thai:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Noto Sans Thai', sans-serif;
            background-color: #f3f4f6; /* gray-100 */
            color: #1f2937; /* gray-800 */
        }
        
        .chart-container {
            position: relative;
            width: 100%;
            height: 300px;
        }

        .app-card {
            background: white;
            border-radius: 1rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            border: 1px solid #e5e7eb;
            overflow: hidden;
            transition: all 0.3s ease;
            height: auto;
            min-height: 500px;
        }

        .main-tab-btn {
            padding: 1rem;
            border-bottom: 3px solid transparent;
            color: #6b7280;
            font-weight: 500;
            transition: all 0.3s ease;
            white-space: nowrap;
        }
        
        .main-tab-active {
            border-bottom-color: #0d9488;
            color: #0d9488;
            font-weight: 700;
            background-color: #f0fdfa;
        }
        
        .main-tab-btn:hover:not(.main-tab-active) {
            color: #374151;
            background-color: #f9fafb;
        }

        .tab-active {
            border-bottom: 2px solid #0d9488;
            color: #0d9488;
            font-weight: 600;
        }

        .tab-inactive {
            color: #6b7280;
            border-bottom: 2px solid transparent;
        }
        
        .tab-inactive:hover {
            color: #374151;
        }

        input[type="date"] {
            appearance: none;
            -webkit-appearance: none;
            color: #374151;
            font-family: 'Noto Sans Thai', sans-serif;
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
            padding: 0.5rem;
        }
    </style>
</head>
<body class="bg-gray-50">

    <nav class="bg-white border-b border-gray-200 sticky top-0 z-50">
        <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 bg-gradient-to-br from-teal-500 to-emerald-600 rounded-lg flex items-center justify-center text-white shadow-lg">
                        <i class="fa-solid fa-dna text-xl"></i>
                    </div>
                    <div>
                        <h1 class="font-bold text-xl text-gray-900 tracking-tight leading-none">AI HEALTH CHOICE</h1>
                        <span class="text-xs text-gray-500 font-medium">Precision Lifestyle Platform</span>
                    </div>
                </div>
                <div class="flex items-center gap-4">
                    <div class="w-10 h-10 rounded-full bg-gray-200 overflow-hidden border-2 border-white shadow-sm">
                        <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Felix" alt="User Profile">
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <main class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        
        <div class="mb-6 text-center md:text-left">
            <h2 class="text-2xl font-bold text-gray-800">ยินดีต้อนรับ, คุณสมชาย</h2>
            <p class="text-gray-600">เลือกฟังก์ชันที่คุณต้องการใช้งาน</p>
        </div>

        <div class="flex overflow-x-auto bg-white rounded-t-xl border border-gray-200 shadow-sm mb-6">
            <button onclick="switchMainTab('microstep')" id="btn-main-microstep" class="main-tab-btn main-tab-active flex-1 flex items-center justify-center gap-2">
                <i class="fa-solid fa-wand-magic-sparkles"></i> Micro-Step Generator
            </button>
            <button onclick="switchMainTab('success')" id="btn-main-success" class="main-tab-btn flex-1 flex items-center justify-center gap-2">
                <i class="fa-solid fa-chart-line"></i> Success Viz
            </button>
            <button onclick="switchMainTab('clinical')" id="btn-main-clinical" class="main-tab-btn flex-1 flex items-center justify-center gap-2">
                <i class="fa-solid fa-user-doctor"></i> Clinical Sync
            </button>
        </div>

        <div class="relative min-h-[600px]">

            <!-- TAB 1: Micro-Step Generator -->
            <div id="section-microstep" class="app-card w-full animate-fade-in">
                <div class="p-5 border-b border-gray-100 bg-gradient-to-r from-gray-50 to-white flex justify-between items-center">
                    <div>
                        <h3 class="font-bold text-lg text-gray-800 flex items-center gap-2">
                            <i class="fa-solid fa-wand-magic-sparkles text-teal-600"></i>
                            สร้างภารกิจจิ๋วตามข้อจำกัด
                        </h3>
                        <p class="text-sm text-gray-500">ระบบ AI วิเคราะห์และออกแบบกิจกรรมที่เหมาะสมกับคุณที่สุด</p>
                    </div>
                    <span class="bg-teal-100 text-teal-700 text-xs px-3 py-1 rounded-full font-bold uppercase">AI Core</span>
                </div>
                
                <div class="p-8 flex flex-col gap-6">
                    <!-- Equality Engine Inputs: Chronic Disease -->
                    <div class="space-y-3">
                        <label class="text-base font-semibold text-gray-700 flex items-center gap-2">
                            <span class="w-6 h-6 rounded-full bg-stone-200 text-stone-600 flex items-center justify-center text-xs">1</span>
                            โรคประจำตัว (Equality Engine)
                        </label>
                        <select id="user-profile" class="w-full text-base p-3 bg-gray-50 border border-gray-300 rounded-lg focus:ring-teal-500 focus:border-teal-500">
                            <option value="diabetes">1 โรคเบาหวาน (Diabetes Mellitus)</option>
                            <option value="hbp">2 โรคความดันโลหิตสูง (Hypertension)</option>
                            <option value="cvd">3 โรคหลอดเลือดหัวใจและสมอง (Cardiovascular & Cerebrovascular Diseases)</option>
                            <option value="none">4 ไม่มีโรค (none)</option>
                        </select>
                    </div>

                    <!-- Constraints section -->
                    <div class="space-y-3">
                        <label class="text-base font-semibold text-gray-700 flex items-center gap-2">
                            <span class="w-6 h-6 rounded-full bg-stone-200 text-stone-600 flex items-center justify-center text-xs">2</span>
                            ข้อจำกัด (Real Constraints)
                        </label>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                            <button onclick="selectConstraint(this, 'cook')" class="constraint-chip p-4 border rounded-xl hover:bg-gray-100 text-gray-600 transition-all text-center flex flex-col items-center gap-2">
                                <i class="fa-solid fa-utensils text-xl"></i> 
                                <span class="text-sm font-medium leading-tight">1 ไม่สะดวกทำอาหาร</span>
                            </button>
                            <button onclick="selectConstraint(this, 'time')" class="constraint-chip p-4 border rounded-xl hover:bg-gray-100 text-gray-600 transition-all text-center flex flex-col items-center gap-2">
                                <i class="fa-solid fa-clock text-xl"></i> 
                                <span class="text-sm font-medium leading-tight">2 ไม่ค่อยมีเวลา</span>
                            </button>
                            <button onclick="selectConstraint(this, 'space')" class="constraint-chip p-4 border rounded-xl hover:bg-gray-100 text-gray-600 transition-all text-center flex flex-col items-center gap-2">
                                <i class="fa-solid fa-expand-arrows-alt text-xl"></i> 
                                <span class="text-sm font-medium leading-tight">3 พื้นที่ไม่อำนวย</span>
                            </button>
                            <button onclick="selectConstraint(this, 'energy')" class="constraint-chip p-4 border rounded-xl hover:bg-gray-100 text-gray-600 transition-all text-center flex flex-col items-center gap-2">
                                <i class="fa-solid fa-battery-quarter text-xl"></i> 
                                <span class="text-sm font-medium leading-tight">4 เหนื่อยล้า</span>
                            </button>
                        </div>
                    </div>

                    <div class="mt-4">
                        <button onclick="generateMission()" class="w-full bg-stone-800 hover:bg-stone-900 text-white font-medium py-4 rounded-xl shadow-lg transition-all flex justify-center items-center gap-2 group text-lg">
                            <i class="fa-solid fa-bolt text-yellow-400 group-hover:animate-pulse"></i> 
                            Generate Mission (คำนวณภารกิจ)
                        </button>
                    </div>

                    <div id="mission-result" class="hidden mt-4 p-6 bg-teal-50 border border-teal-100 rounded-xl relative overflow-hidden transition-all duration-500 transform scale-95 opacity-0">
                        <div class="absolute -right-6 -top-6 text-teal-100 text-8xl opacity-50"><i class="fa-solid fa-check-circle"></i></div>
                        <h4 class="text-base font-bold text-teal-800 uppercase tracking-wide mb-2">ภารกิจวันนี้ของคุณ</h4>
                        <p id="mission-text" class="text-gray-800 font-bold text-xl leading-relaxed mb-4 border-l-4 border-teal-500 pl-4">...</p>
                        <div class="flex items-center gap-2 text-sm text-orange-600 font-semibold bg-white/60 p-3 rounded-lg inline-block shadow-sm">
                            <i class="fa-solid fa-arrow-trend-up"></i> <span id="mission-benefit">...</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- TAB 2: Success Visualization -->
            <div id="section-success" class="app-card w-full hidden animate-fade-in">
                <div class="p-5 border-b border-gray-100 bg-gradient-to-r from-gray-50 to-white flex justify-between items-center">
                    <div>
                        <h3 class="font-bold text-lg text-gray-800 flex items-center gap-2">
                            <i class="fa-solid fa-chart-line text-orange-500"></i>
                            Success Visualization
                        </h3>
                        <p class="text-sm text-gray-500">กราฟวินัย & โมเมนตัมความสำเร็จ</p>
                    </div>
                    <div class="flex items-center gap-1 bg-orange-100 text-orange-700 px-3 py-1 rounded-full text-xs font-bold">
                        <i class="fa-solid fa-fire"></i> Streak: 5 Days
                    </div>
                </div>

                <div class="p-8 flex flex-col gap-6">
                    <div class="chart-container bg-white rounded-xl p-2">
                        <canvas id="consistencyChart"></canvas>
                    </div>

                    <div class="grid grid-cols-2 gap-4">
                        <div class="bg-gray-50 p-6 rounded-xl border border-gray-100 text-center shadow-sm">
                            <div class="text-sm text-gray-500 mb-1">Overall Level</div>
                            <div class="text-3xl font-bold text-stone-800">Lv. 3</div>
                            <div class="text-xs text-teal-600 font-bold uppercase mt-1 tracking-wider">Master Class</div>
                        </div>
                        <div class="bg-gray-50 p-6 rounded-xl border border-gray-100 text-center shadow-sm">
                            <div class="text-sm text-gray-500 mb-1">Consistency Score</div>
                            <div class="text-3xl font-bold text-stone-800">85%</div>
                            <div class="text-xs text-green-600 font-bold mt-1">
                                <i class="fa-solid fa-caret-up"></i> +12% vs last week
                            </div>
                        </div>
                    </div>

                    <div class="mt-auto bg-stone-800 text-white p-6 rounded-xl relative shadow-lg">
                        <i class="fa-solid fa-quote-left text-stone-600 absolute top-4 left-4 text-2xl"></i>
                        <div class="text-xs font-bold text-teal-400 uppercase mb-2 pl-8 tracking-widest">AI Predictive Insight</div>
                        <p class="text-sm md:text-base leading-relaxed pl-8 text-stone-200">
                            "จากกราฟความสม่ำเสมอในสัปดาห์นี้ ระบบวิเคราะห์ว่าสุขภาพของคุณกำลังปรับตัวไปในทิศทางที่ดีขึ้นอย่างต่อเนื่อง"
                        </p>
                    </div>
                </div>
            </div>

            <!-- TAB 3: Clinical Sync -->
            <div id="section-clinical" class="app-card w-full hidden border-t-4 border-t-blue-500 animate-fade-in">
                <div class="p-5 border-b border-gray-100 bg-gradient-to-r from-gray-50 to-white flex justify-between items-center">
                    <div>
                        <h3 class="font-bold text-lg text-gray-800 flex items-center gap-2">
                            <i class="fa-solid fa-user-doctor text-blue-500"></i>
                            Clinical Sync
                        </h3>
                        <p class="text-sm text-gray-500">ระบบจัดการนัดหมายอัจฉริยะ</p>
                    </div>
                    <span class="bg-blue-100 text-blue-700 text-xs px-3 py-1 rounded-full font-bold uppercase">Priority Only</span>
                </div>

                <div class="flex-grow flex flex-col">
                    <div class="flex border-b border-gray-200 bg-gray-50">
                        <button onclick="switchSubTab('doctor')" id="tab-doctor" class="flex-1 py-4 text-sm font-medium text-center tab-active transition-colors hover:bg-white">
                            <i class="fa-solid fa-stethoscope mr-2"></i> นัดแพทย์
                        </button>
                        <button onclick="switchSubTab('lab')" id="tab-lab" class="flex-1 py-4 text-sm font-medium text-center tab-inactive transition-colors hover:bg-white">
                            <i class="fa-solid fa-vial mr-2"></i> เจาะเลือด/แล็บ
                        </button>
                    </div>

                    <div id="content-doctor" class="p-8 space-y-6">
                        <div class="space-y-2">
                            <label class="text-sm font-bold text-gray-700 uppercase">วันที่พบแพทย์ล่าสุด</label>
                            <input type="date" id="doc-last-date" class="w-full bg-white border border-gray-300 rounded-lg text-base p-3 focus:ring-blue-500 focus:border-blue-500 shadow-sm">
                        </div>
                        <div class="space-y-2">
                            <label class="text-sm font-bold text-gray-700 uppercase">กลุ่มอาการ/โรค</label>
                            <select id="doc-condition" class="w-full bg-white border border-gray-300 rounded-lg text-base p-3 shadow-sm">
                                <option value="stable">อาการทั่วไป / คงที่ (3 เดือน)</option>
                                <option value="unstable">อาการไม่คงที่ / ปรับยา (1 เดือน)</option>
                                <option value="urgent">ติดตามผลด่วน (2 สัปดาห์)</option>
                            </select>
                        </div>
                        <button onclick="calculateNextAppt('doctor')" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3.5 rounded-lg shadow-md text-base transition-all mt-4">
                            AI คำนวณวันนัดถัดไป
                        </button>
                    </div>

                    <div id="content-lab" class="p-8 space-y-6 hidden">
                        <div class="space-y-2">
                            <label class="text-sm font-bold text-gray-700 uppercase">วันที่เจาะเลือดล่าสุด</label>
                            <input type="date" id="lab-last-date" class="w-full bg-white border border-gray-300 rounded-lg text-base p-3 focus:ring-blue-500 focus:border-blue-500 shadow-sm">
                        </div>
                        <div class="space-y-2">
                            <label class="text-sm font-bold text-gray-700 uppercase">ประเภทการตรวจ</label>
                            <select id="lab-type" class="w-full bg-white border border-gray-300 rounded-lg text-base p-3 shadow-sm">
                                <option value="diabetes">เบาหวาน (HbA1c)</option>
                                <option value="lipid">ไขมันในเลือด (Lipid Profile)</option>
                                <option value="kidney">ค่าไต (Kidney Function)</option>
                                <option value="general">ตรวจสุขภาพประจำปี</option>
                            </select>
                        </div>
                        <button onclick="calculateNextAppt('lab')" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3.5 rounded-lg shadow-md text-base transition-all mt-4">
                            AI คำนวณวันเจาะเลือด
                        </button>
                    </div>

                    <div id="appt-result" class="mx-8 mb-8 p-6 bg-gray-800 rounded-xl hidden transition-all">
                        <div class="flex justify-between items-start mb-4">
                            <span class="text-xs font-bold text-gray-400 uppercase tracking-wider">Estimated Appointment</span>
                            <span id="appt-badge" class="px-3 py-1 bg-blue-500 text-white text-xs rounded-full font-bold">NEXT</span>
                        </div>
                        <div class="text-3xl font-bold text-white mb-2" id="appt-date-display">--/--/----</div>
                        <p class="text-sm text-gray-300 mb-4" id="appt-note">...</p>
                        
                        <div class="pt-4 border-t border-gray-700 flex gap-3">
                            <div class="w-8 h-8 rounded-full bg-gray-700 flex items-center justify-center flex-shrink-0">
                                <i class="fa-solid fa-triangle-exclamation text-yellow-500 text-sm"></i>
                            </div>
                            <div>
                                <p class="text-xs text-gray-400 uppercase font-bold mb-1">คำแนะนำเตรียมตัว</p>
                                <p class="text-sm text-gray-200 leading-tight" id="appt-prep">
                                    ระบบจะแจ้งเตือนล่วงหน้า 3 วันก่อนถึงกำหนด
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer class="mt-8 py-6 text-center text-gray-400 text-xs border-t border-gray-200 bg-white">
        <p>&copy; 2024 AI Health Choice. Precision Lifestyle Integration Platform.</p>
    </footer>

    <script>
        let selectedConstraint = null;
        let chartInstance = null;

        function switchMainTab(tabId) {
            document.getElementById('section-microstep').classList.add('hidden');
            document.getElementById('section-success').classList.add('hidden');
            document.getElementById('section-clinical').classList.add('hidden');
            
            const buttons = document.querySelectorAll('.main-tab-btn');
            buttons.forEach(btn => btn.classList.remove('main-tab-active'));

            document.getElementById('section-' + tabId).classList.remove('hidden');
            document.getElementById('btn-main-' + tabId).classList.add('main-tab-active');

            if (tabId === 'success' && chartInstance) {
                setTimeout(() => chartInstance.resize(), 100);
            }
        }

        function selectConstraint(btn, type) {
            document.querySelectorAll('.constraint-chip').forEach(b => {
                b.classList.remove('bg-teal-600', 'text-white', 'border-transparent');
                b.classList.add('text-gray-600', 'border-gray-200');
            });
            btn.classList.remove('text-gray-600', 'border-gray-200');
            btn.classList.add('bg-teal-600', 'text-white', 'border-transparent');
            selectedConstraint = type;
        }

        function generateMission() {
            const profile = document.getElementById('user-profile').value;
            const constraint = selectedConstraint || 'time';
            
            // Logic database updated to match new options
            const missions = {
                'diabetes': {
                    'cook': { text: "สั่งข้าวราดแกง เน้นผักและโปรตีน งดแกงกะทิและของทอด", benefit: "คุมน้ำตาลได้แม้ไม่ได้ทำอาหารเอง" },
                    'time': { text: "ดื่มน้ำเปล่า 1 แก้วใหญ่ทันทีหลังตื่นนอน", benefit: "ช่วยระบบเผาผลาญในเวลาไม่ถึงนาที" },
                    'space': { text: "ลุกนั่ง (Squat) ข้างเก้าอี้ 15 ครั้ง", benefit: "กระตุ้นกล้ามเนื้อดึงน้ำตาลไปใช้" },
                    'energy': { text: "เดินรอบบ้านหรือที่พัก 5 นาทีหลังมื้ออาหาร", benefit: "ช่วยลดระดับน้ำตาลหลังกินข้าว" }
                },
                'hbp': {
                    'cook': { text: "สั่งก๋วยเตี๋ยว 'ไม่ใส่น้ำซุป' หรือ 'ไม่ปรุงเพิ่ม'", benefit: "ลดปริมาณโซเดียมได้มหาศาล" },
                    'time': { text: "ฝึกหายใจเข้า-ออกลึกๆ 10 รอบ", benefit: "ช่วยให้หลอดเลือดคลายตัว ลดความดัน" },
                    'space': { text: "แกว่งแขน 10 นาที ขณะดูโทรทัศน์หรือฟังเพลง", benefit: "ลดความดันโลหิตและกระตุ้นการไหลเวียน" },
                    'energy': { text: "แช่เท้าในน้ำอุ่นก่อนนอน 10 นาที", benefit: "ผ่อนคลายระบบประสาท ลดความดันโลหิต" }
                },
                'cvd': {
                    'cook': { text: "เลือกทานปลาหรืออกไก่ แทนเนื้อติดมันในการสั่งอาหาร", benefit: "ลดไขมันอิ่มตัว ป้องกันหลอดเลือดอุดตัน" },
                    'time': { text: "ลุกขึ้นยืนและบิดตัวทุกๆ 1 ชั่วโมงที่นั่งทำงาน", benefit: "ลดการคั่งของเลือดในหลอดเลือดดำ" },
                    'space': { text: "ยืดเหยียดกล้ามเนื้อทั่วตัวบนเตียงนอน", benefit: "เพิ่มความยืดหยุ่นของหลอดเลือด" },
                    'energy': { text: "งดเล่นมือถือก่อนนอน 30 นาที เพื่อการพักผ่อนที่มีคุณภาพ", benefit: "ลดความเครียดของหัวใจ" }
                },
                'none': {
                    'cook': { text: "เน้นทานผักครึ่งหนึ่งของจานในทุกมื้อ", benefit: "รักษาสมดุลร่างกายและเพิ่มกากใย" },
                    'time': { text: "ขึ้นบันไดแทนการใช้ลิฟต์อย่างน้อย 2 ชั้น", benefit: "บริหารหัวใจในชีวิตประจำวัน" },
                    'space': { text: "Plank 1 นาทีในห้องนอน", benefit: "สร้างความแข็งแรงของแกนกลางลำตัว" },
                    'energy': { text: "อาบน้ำอุ่นสลับเย็นเพื่อกระตุ้นระบบไหลเวียน", benefit: "เพิ่มความสดชื่นและภูมิคุ้มกัน" }
                }
            };
            
            let data = missions[profile] && missions[profile][constraint];
            if(!data) data = { text: "เดินเพิ่มขึ้น 500 ก้าวในวันนี้", benefit: "เผาผลาญพลังงานพื้นฐาน" };

            const resultDiv = document.getElementById('mission-result');
            resultDiv.classList.remove('hidden', 'scale-95', 'opacity-0');
            resultDiv.classList.add('scale-100', 'opacity-100');
            
            document.getElementById('mission-text').textContent = data.text;
            document.getElementById('mission-benefit').textContent = data.benefit;
        }

        function initChart() {
            const ctx = document.getElementById('consistencyChart').getContext('2d');
            chartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['M', 'T', 'W', 'T', 'F', 'S', 'S'],
                    datasets: [{
                        label: 'Success Score',
                        data: [65, 70, 80, 85, 82, 90, 95],
                        borderColor: '#f97316',
                        backgroundColor: 'rgba(249, 115, 22, 0.1)',
                        borderWidth: 3,
                        tension: 0.4,
                        fill: true,
                        pointBackgroundColor: '#fff',
                        pointBorderWidth: 2,
                        pointRadius: 5
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: { display: true, min: 50, max: 100 },
                        x: { grid: { display: false } }
                    }
                }
            });
        }

        function switchSubTab(tab) {
            const contentDoc = document.getElementById('content-doctor');
            const contentLab = document.getElementById('content-lab');
            const btnDoc = document.getElementById('tab-doctor');
            const btnLab = document.getElementById('tab-lab');
            document.getElementById('appt-result').classList.add('hidden');

            if (tab === 'doctor') {
                contentDoc.classList.remove('hidden');
                contentLab.classList.add('hidden');
                btnDoc.classList.add('tab-active');
                btnDoc.classList.remove('tab-inactive');
                btnLab.classList.add('tab-inactive');
                btnLab.classList.remove('tab-active');
            } else {
                contentDoc.classList.add('hidden');
                contentLab.classList.remove('hidden');
                btnLab.classList.add('tab-active');
                btnLab.classList.remove('tab-inactive');
                btnDoc.classList.add('tab-inactive');
                btnDoc.classList.remove('tab-active');
            }
        }

        function calculateNextAppt(type) {
            let lastDateInput, condition, intervalMonths, note, prep;
            if (type === 'doctor') {
                lastDateInput = document.getElementById('doc-last-date').value;
                condition = document.getElementById('doc-condition').value;
                if (!lastDateInput) return;
                intervalMonths = condition === 'stable' ? 3 : (condition === 'unstable' ? 1 : 0.5);
                note = "การติดตามผลโดย AI";
                prep = "เตรียมข้อมูลสุขภาพเบื้องต้นมาด้วย";
            } else {
                lastDateInput = document.getElementById('lab-last-date').value;
                if (!lastDateInput) return;
                intervalMonths = 3;
                note = "การเจาะเลือดติดตามผล";
                prep = "งดน้ำและอาหารตามคำแนะนำแพทย์";
            }

            const nextDate = new Date(lastDateInput);
            if (intervalMonths >= 1) nextDate.setMonth(nextDate.getMonth() + intervalMonths);
            else nextDate.setDate(nextDate.getDate() + 14);

            document.getElementById('appt-date-display').textContent = nextDate.toLocaleDateString('th-TH', { year: 'numeric', month: 'long', day: 'numeric', weekday: 'long' });
            document.getElementById('appt-note').textContent = note;
            document.getElementById('appt-prep').textContent = prep;
            document.getElementById('appt-result').classList.remove('hidden');
        }

        document.addEventListener('DOMContentLoaded', () => {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('doc-last-date').value = today;
            document.getElementById('lab-last-date').value = today;
            initChart();
        });
    </script>
</body>
</html>